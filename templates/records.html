{% extends "base.html" %}

{% block title %}Todos os Registros{% endblock %}

{% block content %}
    <h1>Todos os Registros de Estudo</h1>

    <div class="filter-sort-controls">
        <form method="GET" action="{{ url_for('view_records') }}" class="filter-sort-form">
            <div class="filter-group">
                <label for="subject_filter">Filtrar por Matéria:</label>
                <select id="subject_filter" name="subject_filter">
                    <option value="">Todas</option>
                    {% for subject in unique_subjects %}
                        <option value="{{ subject }}" {% if subject == current_subject_filter %}selected{% endif %}>{{ subject }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sort_by">Ordenar por:</label>
                <select id="sort_by" name="sort_by">
                    <option value="timestamp" {% if current_sort_by == 'timestamp' %}selected{% endif %}>Data</option>
                    <option value="subject" {% if current_sort_by == 'subject' %}selected{% endif %}>Matéria</option>
                    <option value="duration" {% if current_sort_by == 'duration' %}selected{% endif %}>Duração</option>
                    <option value="quality" {% if current_sort_by == 'quality' %}selected{% endif %}>Qualidade</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sort_order">Ordem:</label>
                <select id="sort_order" name="sort_order">
                    <option value="desc" {% if current_sort_order == 'desc' %}selected{% endif %}>Descendente</option>
                    <option value="asc" {% if current_sort_order == 'asc' %}selected{% endif %}>Ascendente</option>
                </select>
            </div>
            
            <button type="submit" class="button filter-button">Aplicar</button>
        </form>
    </div>

    {% if records %}
        <div class="table-responsive">
            <table class="records-table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Hora</th>
                        <th>Matéria</th>
                        <th>Duração</th>
                        <th>Qualidade</th>
                        <th>Notas</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                        <tr>
                            <td>{{ record.formatted_date }}</td>
                            <td>{{ record.formatted_time }}</td>
                            <td>{{ record.subject }}</td>
                            <td>{{ record.formatted_duration }}</td>
                            <td>{{ record.display_quality }}</td>
                            <td>{{ record.notes }}</td>
                            <td class="actions-cell">
                                <a href="{{ url_for('edit_record', timestamp=record.timestamp) }}" class="button edit-button">Editar</a>
                                <form action="{{ url_for('delete_record', timestamp=record.timestamp) }}" method="POST" style="display:inline-block; margin-left: 5px;">
                                    <button type="submit" class="button delete-button" onclick="return confirm('Tem certeza que deseja excluir este registro?');">Excluir</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <p class="info-message total-records">Total de sessões encontradas: {{ records|length }}</p>
    {% else %}
        <p class="info-message">Nenhum registro de estudo encontrado com os filtros atuais.</p>
    {% endif %}

    <div class="action-buttons-group">
        <a href="{{ url_for('register_session') }}" class="button primary-button">Registrar Nova Sessão</a>
    </div>
{% endblock %}